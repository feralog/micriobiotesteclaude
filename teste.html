<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quiz Arboviroses</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            background-color: #f8f9fa;
            padding-top: 20px;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        .quiz-container {
            max-width: 800px;
            margin: 0 auto;
            background-color: #fff;
            border-radius: 10px;
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
            padding: 30px;
        }
        .timer {
            position: fixed;
            top: 10px;
            right: 10px;
            background-color: #007bff;
            color: white;
            padding: 10px 15px;
            border-radius: 25px;
            font-weight: bold;
            z-index: 1000;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }
        .option {
            cursor: pointer;
            padding: 15px;
            margin: 10px 0;
            border-radius: 8px;
            border: 1px solid #dee2e6;
            transition: all 0.3s;
        }
        .option:hover {
            background-color: #f1f8ff;
            border-color: #b8daff;
        }
        .option.correct {
            background-color: #d4edda;
            border-color: #c3e6cb;
            color: #155724;
        }
        .option.incorrect {
            background-color: #f8d7da;
            border-color: #f5c6cb;
            color: #721c24;
        }
        .explanation {
            background-color: #e9ecef;
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
            display: none;
        }
        .question-list-item {
            cursor: pointer;
            padding: 15px;
            margin: 10px 0;
            border-radius: 8px;
            border: 1px solid #dee2e6;
            background-color: #f8f9fa;
        }
        .question-detail {
            background-color: #fff;
            padding: 15px;
            border-radius: 8px;
            margin-top: 10px;
            display: none;
        }
        .leaderboard-table {
            width: 100%;
            margin-top: 20px;
        }
        .section {
            display: none;
        }
        .active {
            display: block;
        }
        h1, h2, h3 {
            color: #0056b3;
        }
        .btn-next {
            display: none;
        }
    </style>
</head>
<body>
    <!-- Timer -->
    <div id="timer" class="timer" style="display: none;">00:00</div>

    <div class="container quiz-container">
        <!-- Tela Inicial -->
        <section id="start-section" class="section active">
            <h1 class="text-center mb-4">Quiz sobre Arboviroses</h1>
            <div class="mb-3">
                <label for="username" class="form-label">Digite seu nome:</label>
                <input type="text" class="form-control" id="username" placeholder="Seu nome" required>
            </div>
            <button id="start-button" class="btn btn-primary btn-lg w-100">Iniciar Quiz</button>
        </section>

        <!-- Tela do Quiz -->
        <section id="quiz-section" class="section">
            <h2 id="question-number" class="mb-3">Questão 1</h2>
            <h3 id="question-text" class="mb-4"></h3>
            
            <div id="options-container"></div>
            
            <div id="explanation" class="explanation"></div>
            
            <button id="next-button" class="btn btn-primary mt-3 btn-next">Próxima Questão</button>
        </section>

        <!-- Tela de Resultados -->
        <section id="results-section" class="section">
            <h2 class="mb-4 text-center">Resultado Final</h2>
            
            <div class="alert alert-primary" role="alert">
                <strong id="final-score">Você acertou X de Y questões</strong>
                <div id="final-time" class="mt-2">Tempo total: 00:00</div>
            </div>
            
            <h3 class="mb-3">Suas respostas:</h3>
            <div id="questions-list"></div>
            
            <h3 class="mt-4 mb-3">Classificação</h3>
            <div class="table-responsive">
                <table class="table table-striped leaderboard-table">
                    <thead>
                        <tr>
                            <th>#</th>
                            <th>Nome</th>
                            <th>Pontuação</th>
                            <th>Tempo</th>
                        </tr>
                    </thead>
                    <tbody id="leaderboard-body"></tbody>
                </table>
            </div>
            
            <button id="restart-button" class="btn btn-primary btn-lg w-100 mt-4">Voltar ao Início</button>
        </section>
    </div>

    <!-- Script Bootstrap (Popper incluído) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>
    
    <script>
        // Configuração da API Backend
        const API_URL = 'https://script.google.com/macros/s/AKfycbzcUmesPg7SHDTjoBSmW9A37M2U6pETbZpQGDSsXlfHucBUVdlpqNwXncBwNCB_bIJV0A/exec';
        
        // Dados do quiz
        const questions = [
            {
                question: "Qual família viral inclui o vírus da febre amarela?",
                options: ["Togaviridae", "Flaviviridae", "Bunyaviridae", "Reoviridae"],
                correctIndex: 1,
                explanation: "Flaviviridae é a família que inclui o vírus da febre amarela."
            },
            {
                question: "O principal vetor urbano da dengue no Brasil é:",
                options: ["Culex spp.", "Haemagogus spp.", "Aedes aegypti", "Sabethes spp."],
                correctIndex: 2,
                explanation: "Aedes aegypti é o principal vetor urbano da dengue no Brasil."
            },
            {
                question: "A fase crítica da dengue é caracterizada principalmente por:",
                options: ["Febre alta persistente", "Hemorragia grave e extravasamento plasmático", "Hepatite fulminante", "Conjuntivite"],
                correctIndex: 1,
                explanation: "A fase crítica envolve hemorragias e extravasamento de plasma."
            },
            {
                question: "Em relação à febre amarela, o sinal de Faget consiste em:",
                options: ["Bradicardia com febre alta", "Taquicardia e febre baixa", "Bradicardia e hipotermia", "Hipotensão isolada"],
                correctIndex: 0,
                explanation: "Sinal de Faget é a associação de febre alta com bradicardia."
            },
            {
                question: "No ciclo da febre amarela, os reservatórios silvestres incluem:",
                options: ["Cães e gatos", "Humanos", "Macacos", "Mosquitos"],
                correctIndex: 2,
                explanation: "Macacos são os principais reservatórios silvestres da febre amarela."
            },
            {
                question: "A transmissão alternativa do vírus Zika inclui:",
                options: ["Transmissão por alimentos", "Transmissão sexual", "Transmissão vetorial exclusivamente", "Transmissão por objetos contaminados"],
                correctIndex: 1,
                explanation: "O vírus Zika pode ser transmitido sexualmente além do vetor."
            },
            {
                question: "A febre amarela pode ser prevenida por:",
                options: ["Antibióticos", "Soroterapia", "Vacinação", "Antivirais específicos"],
                correctIndex: 2,
                explanation: "A vacinação é a forma eficaz de prevenção contra febre amarela."
            },
            {
                question: "Um fator de risco para expansão das arboviroses é:",
                options: ["Urbanização planejada", "Baixa mobilidade populacional", "Transporte intenso de cargas", "Saneamento básico adequado"],
                correctIndex: 2,
                explanation: "O transporte intenso de cargas facilita a expansão de vetores."
            },
            {
                question: "A principal fase de viremia da chikungunya dura aproximadamente:",
                options: ["3 dias", "7 dias", "10 dias", "14 dias"],
                correctIndex: 2,
                explanation: "A fase de viremia na chikungunya dura cerca de 10 dias."
            },
            {
                question: "A síndrome de Guillain-Barré está associada principalmente a infecção por:",
                options: ["Dengue", "Febre Amarela", "Zika", "Chikungunya"],
                correctIndex: 2,
                explanation: "O vírus Zika é fortemente associado à síndrome de Guillain-Barré."
            },
            {
                question: "No diagnóstico de dengue, a proteína detectada por testes é:",
                options: ["NS1", "GP120", "M1", "HA"],
                correctIndex: 0,
                explanation: "A proteína NS1 é detectada em testes rápidos de dengue."
            },
            {
                question: "A infecção sequencial por sorotipos diferentes da dengue pode levar a:",
                options: ["Hepatite autoimune", "Dengue grave (SCD/FHD)", "Síndrome nefrótica", "Paralisia facial"],
                correctIndex: 1,
                explanation: "A infecção por sorotipos diferentes aumenta o risco de dengue grave."
            },
            {
                question: "Um sintoma típico da fase crônica da chikungunya é:",
                options: ["Febre alta", "Alopecia", "Náusea intensa", "Anemia severa"],
                correctIndex: 1,
                explanation: "Alopecia pode ocorrer na fase crônica da chikungunya."
            },
            {
                question: "Qual fator imunológico é associado à teoria dos anticorpos potencializadores da dengue?",
                options: ["Resposta mediada por células T", "Formação de autoanticorpos", "Antibody Dependent Enhancement (ADE)", "Deposição de complexos imunes"],
                correctIndex: 2,
                explanation: "O fenômeno ADE explica a gravidade em infecções secundárias de dengue."
            },
            {
                question: "No tratamento das arboviroses, deve-se evitar:",
                options: ["Paracetamol", "Hidratação oral", "Salicilatos", "Reposição de eletrólitos"],
                correctIndex: 2,
                explanation: "Salicilatos devem ser evitados pelo risco de sangramento nas arboviroses."
            }
        ];

        // Variáveis globais
        let currentQuestionIndex = 0;
        let score = 0;
        let userAnswers = [];
        let startTime;
        let timerInterval;
        let seconds = 0;
        let questionAnswered = false;

        // Elementos DOM
        const startSection = document.getElementById('start-section');
        const quizSection = document.getElementById('quiz-section');
        const resultsSection = document.getElementById('results-section');
        const startButton = document.getElementById('start-button');
        const nextButton = document.getElementById('next-button');
        const restartButton = document.getElementById('restart-button');
        const usernameInput = document.getElementById('username');
        const questionNumber = document.getElementById('question-number');
        const questionText = document.getElementById('question-text');
        const optionsContainer = document.getElementById('options-container');
        const explanationContainer = document.getElementById('explanation');
        const timerElement = document.getElementById('timer');
        const finalScore = document.getElementById('final-score');
        const finalTime = document.getElementById('final-time');
        const questionsList = document.getElementById('questions-list');
        const leaderboardBody = document.getElementById('leaderboard-body');

        // Inicialização dos eventos
        document.addEventListener('DOMContentLoaded', () => {
            // Botão iniciar quiz
            startButton.addEventListener('click', startQuiz);
            
            // Botão próxima questão
            nextButton.addEventListener('click', nextQuestion);
            
            // Botão recomeçar
            restartButton.addEventListener('click', restartQuiz);
        });

        // Função para iniciar o quiz
        function startQuiz() {
            // Verificar se o nome foi preenchido
            if (!usernameInput.value.trim()) {
                alert('Por favor, digite seu nome para começar.');
                return;
            }
            
            // Resetar variáveis
            currentQuestionIndex = 0;
            score = 0;
            userAnswers = [];
            seconds = 0;
            
            // Alternar a visibilidade das seções
            startSection.classList.remove('active');
            quizSection.classList.add('active');
            timerElement.style.display = 'block';
            
            // Iniciar o cronômetro
            startTime = new Date();
            timerInterval = setInterval(updateTimer, 1000);
            
            // Carregar a primeira questão
            loadQuestion();
        }

        // Função para atualizar o cronômetro
        function updateTimer() {
            seconds++;
            const minutes = Math.floor(seconds / 60);
            const remainingSeconds = seconds % 60;
            
            // Formatar a exibição
            const minutesStr = minutes < 10 ? `0${minutes}` : `${minutes}`;
            const secondsStr = remainingSeconds < 10 ? `0${remainingSeconds}` : `${remainingSeconds}`;
            
            timerElement.textContent = `${minutesStr}:${secondsStr}`;
        }

        // Função para carregar uma questão
        function loadQuestion() {
            // Resetar o estado da questão
            questionAnswered = false;
            explanationContainer.style.display = 'none';
            nextButton.style.display = 'none';
            
            const question = questions[currentQuestionIndex];
            
            // Atualizar o número e texto da questão
            questionNumber.textContent = `Questão ${currentQuestionIndex + 1} de ${questions.length}`;
            questionText.textContent = question.question;
            
            // Limpar e carregar as opções
            optionsContainer.innerHTML = '';
            const letters = ['a', 'b', 'c', 'd', 'e'];
            
            question.options.forEach((option, index) => {
                const optionElement = document.createElement('div');
                optionElement.className = 'option';
                optionElement.textContent = `${letters[index]}) ${option}`;
                optionElement.dataset.index = index;
                
                // Adicionar evento de clique
                optionElement.addEventListener('click', () => selectOption(index));
                
                optionsContainer.appendChild(optionElement);
            });
        }

        // Função para selecionar uma opção
        function selectOption(index) {
            // Evitar múltiplas seleções para a mesma questão
            if (questionAnswered) return;
            
            questionAnswered = true;
            const question = questions[currentQuestionIndex];
            const options = optionsContainer.querySelectorAll('.option');
            
            // Marcar a opção correta e errada
            options[question.correctIndex].classList.add('correct');
            
            // Registrar a resposta do usuário
            const isCorrect = index === question.correctIndex;
            if (isCorrect) {
                score++;
            } else {
                options[index].classList.add('incorrect');
            }
            
            userAnswers.push({
                questionIndex: currentQuestionIndex,
                userAnswerIndex: index,
                isCorrect
            });
            
            // Mostrar explicação
            explanationContainer.textContent = question.explanation;
            explanationContainer.style.display = 'block';
            
            // Mostrar botão de próxima questão ou finalizar
            if (currentQuestionIndex < questions.length - 1) {
                nextButton.textContent = 'Próxima Questão';
                nextButton.style.display = 'block';
            } else {
                nextButton.textContent = 'Ver Resultados';
                nextButton.style.display = 'block';
            }
        }

        // Função para ir para a próxima questão
        function nextQuestion() {
            currentQuestionIndex++;
            
            if (currentQuestionIndex < questions.length) {
                loadQuestion();
            } else {
                finishQuiz();
            }
        }

        // Função para finalizar o quiz
        function finishQuiz() {
            // Parar o cronômetro
            clearInterval(timerInterval);
            
            // Alternar a visibilidade das seções
            quizSection.classList.remove('active');
            resultsSection.classList.add('active');
            timerElement.style.display = 'none';
            
            // Exibir pontuação final
            finalScore.textContent = `Você acertou ${score} de ${questions.length} questões`;
            finalTime.textContent = `Tempo total: ${formatTime(seconds)}`;
            
            // Exibir respostas do usuário
            displayUserAnswers();
            
            // Enviar resultado ao backend
            sendResultToBackend();
            
            // Carregar o leaderboard
            loadLeaderboard();
        }

        // Função para formatar o tempo
        function formatTime(totalSeconds) {
            const minutes = Math.floor(totalSeconds / 60);
            const seconds = totalSeconds % 60;
            return `${minutes < 10 ? '0' + minutes : minutes}:${seconds < 10 ? '0' + seconds : seconds}`;
        }

        // Função para exibir as respostas do usuário
        function displayUserAnswers() {
            questionsList.innerHTML = '';
            const letters = ['a', 'b', 'c', 'd', 'e'];
            
            userAnswers.forEach((answer, index) => {
                const question = questions[answer.questionIndex];
                
                // Item da lista
                const listItem = document.createElement('div');
                listItem.className = `question-list-item ${answer.isCorrect ? 'bg-light' : 'bg-light-danger'}`;
                
                // Texto do item
                const itemText = document.createElement('div');
                itemText.innerHTML = `
                    <strong>Questão ${index + 1}:</strong> 
                    Você marcou <span class="${answer.isCorrect ? 'text-success' : 'text-danger'}">
                    ${letters[answer.userAnswerIndex]}</span>, 
                    a correta era <span class="text-success">${letters[question.correctIndex]}</span>
                `;
                
                // Detalhe da questão (expandível)
                const detailContainer = document.createElement('div');
                detailContainer.className = 'question-detail';
                detailContainer.innerHTML = `
                    <p><strong>${question.question}</strong></p>
                    <div class="options-review">
                        ${question.options.map((option, i) => `
                            <div class="option ${i === question.correctIndex ? 'correct' : ''} 
                                                ${i === answer.userAnswerIndex && i !== question.correctIndex ? 'incorrect' : ''}">
                                ${letters[i]}) ${option}
                            </div>
                        `).join('')}
                    </div>
                    <div class="explanation" style="display: block;">
                        ${question.explanation}
                    </div>
                `;
                
                // Adicionar evento para expandir/colapsar
                listItem.addEventListener('click', () => {
                    if (detailContainer.style.display === "none" || !detailContainer.style.display) {
                        detailContainer.style.display = "block";
                    } else {
                        detailContainer.style.display = "none";
                    }
                });
                
                // Adicionar elementos ao DOM
                listItem.appendChild(itemText);
                listItem.appendChild(detailContainer);
                questionsList.appendChild(listItem);
            });
        }

        // Função para enviar resultado ao backend
        function sendResultToBackend() {
            const userData = {
                usuario: usernameInput.value.trim(),
                pontuacao: score,
                tempo: seconds
            };
            
            fetch(API_URL, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(userData)
            })
            .catch(error => {
                console.error('Erro ao enviar dados:', error);
            });
        }

        // Função para carregar o leaderboard
        function loadLeaderboard() {
            fetch(API_URL)
                .then(response => response.json())
                .then(data => {
                    // Limpar tabela
                    leaderboardBody.innerHTML = '';
                    
                    // Preencher com dados
                    data.forEach((entry, index) => {
                        const row = document.createElement('tr');
                        
                        row.innerHTML = `
                            <td>${index + 1}</td>
                            <td>${entry.usuario}</td>
                            <td>${entry.pontuacao}</td>
                            <td>${formatTime(entry.tempo)}</td>
                        `;
                        
                        leaderboardBody.appendChild(row);
                    });
                })
                .catch(error => {
                    console.error('Erro ao carregar leaderboard:', error);
                    leaderboardBody.innerHTML = '<tr><td colspan="4" class="text-center">Erro ao carregar classificação.</td></tr>';
                });
        }

        // Função para reiniciar o quiz
        function restartQuiz() {
            // Voltar para a tela inicial
            resultsSection.classList.remove('active');
            startSection.classList.add('active');
            
            // Limpar o nome do usuário para nova entrada
            usernameInput.value = '';
            
            // Focar no campo de nome
            usernameInput.focus();
        }
    </script>
</body>
</html>